<%- include('../partials/user-header') %>

<section class="card" style="max-width: 600px; margin: 0 auto; margin-top: 2rem;">
    <div class="card-header">
        <h2><i class="ph ph-gear"></i> <%= t.settings.title %></h2>
    </div>

    <div style="padding: 20px; border-bottom: 1px solid var(--glass-border); display: flex; align-items: center; gap: 20px;">
        <div class="avatar" style="width: 80px; height: 80px; font-size: 2rem;">
            <%= (typeof userName !== 'undefined' && userName) ? userName[0].toUpperCase() : 'U' %>
        </div>
        <div>
            <h3 style="margin-bottom: 5px;"><%= typeof userName !== 'undefined' ? userName : t.adminRequests.user %></h3>
            
            <p style="color: var(--text-muted); font-size: 0.9rem;">
                <%= (user && user.pharmacyName) ? user.pharmacyName : t.common.pharmacy %>
            </p>
        </div>
    </div>

    <div style="padding: 20px; display: flex; align-items: center; justify-content: space-between;">
        <div>
            <h4 style="margin-bottom: 5px;"><i class="ph ph-paint-brush"></i> <%= t.settings.appearance %></h4>
            
            <p style="color: var(--text-muted); font-size: 0.9rem;"><%= t.settings.appearanceDesc %></p>
        </div>
        
        <button id="themeToggle" class="btn-icon" style="width: 50px; height: 50px; border-radius: 50%; background: var(--surface-light); color: var(--text-main); font-size: 1.5rem;">
            <i class="ph ph-moon" id="themeIcon"></i>
        </button>
    </div>

    <div style="padding: 20px; border-top: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: space-between;">
        <div>
            <h4 style="margin-bottom: 5px;"><i class="ph ph-globe"></i> <%= t.settings.language %></h4>
            
            <p style="color: var(--text-muted); font-size: 0.9rem;"><%= t.settings.languageDesc %></p>
        </div>

        <div class="lang-toggle-group">
            <a href="/lang/en" class="<%= lang === 'en' ? 'active' : '' %>">EN</a>
            <a href="/lang/fa" class="<%= lang === 'fa' ? 'active' : '' %>">فا</a>
            <a href="/lang/ps" class="<%= lang === 'ps' ? 'active' : '' %>">پښ</a>
        </div>
    </div>

    <div style="padding: 20px; border-top: 1px solid var(--glass-border);">
        <a href="/user/logout" class="btn-text" style="color: var(--danger); width: 100%; text-align: center; display: block; padding: 10px;">
            <i class="ph ph-sign-out"></i> <%= t.settings.logout %>
        </a>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleBtn = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const htmlEl = document.documentElement;

        const currentTheme = localStorage.getItem('theme') || 'dark';
        if (currentTheme === 'light') {
            themeIcon.classList.replace('ph-moon', 'ph-sun');
            themeIcon.style.color = "#f59e0b";
        }

        toggleBtn.addEventListener('click', () => {
            const isDark = htmlEl.getAttribute('data-theme') !== 'light';
            if (isDark) {
                htmlEl.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                themeIcon.classList.replace('ph-moon', 'ph-sun');
                themeIcon.style.color = "#f59e0b";
            } else {
                htmlEl.removeAttribute('data-theme');
                localStorage.setItem('theme', 'dark');
                themeIcon.classList.replace('ph-sun', 'ph-moon');
                themeIcon.style.color = "var(--text-main)";
            }
        });
    });
</script>

<%- include('../partials/mobile-nav', { page: 'settings' }) %>
<%- include('../partials/footer') %>